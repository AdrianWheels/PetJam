# Gu√≠a de Personalizaci√≥n del DungeonLayout

## üìã Resumen de Implementaci√≥n

Se ha creado un **DungeonLayout visual y manipulable** que reemplaza el sistema anterior de spawn calculado por c√≥digo.

**IMPORTANTE:** El sistema visual (DungeonLayout) convive con la l√≥gica de juego (Corridor). 
- **DungeonLayout**: Fondos, decoraci√≥n, markers de posici√≥n
- **Corridor**: Hero, Enemy, combate (l√≥gica)
- Los fondos viejos de Corridor est√°n **desactivados** para evitar doble renderizado

### ‚úÖ Archivos Creados/Modificados

1. **`scenes/DungeonLayout.tscn`** ‚Äî Escena principal del layout de dungeon
2. **`scripts/gameplay/DungeonLayout.gd`** ‚Äî Script que gestiona zonas y spawns
3. **`scripts/gameplay/Corridor.gd`** ‚Äî Modificado para usar DungeonLayout
4. **`scenes/Corridor.tscn`** ‚Äî Desactivados `ParallaxBG` y `BackgroundWalls` (visible=false)
5. **`scenes/Main.tscn`** ‚Äî Integra DungeonLayout en DungeonArea
6. **`scripts/main.gd`** ‚Äî A√±adido @onready para dungeon_area
7. **`.github/copilot-instructions.md`** ‚Äî Actualizado con info de resoluci√≥n m√≥vil

---

## üì± Resoluciones y Display

### Configuraci√≥n Actual

**Desktop (base de dise√±o):**
- Resoluci√≥n: 1280x720 (16:9)
- Aspect ratio: Widescreen est√°ndar

**M√≥vil (viewport actual):**
- Resoluci√≥n: 1080x1350 (4:5 portrait)
- Aspect ratio: M√°s cuadrado que 16:9

### ¬øEs correcta la resoluci√≥n m√≥vil actual?

**1080x1350 es v√°lida**, pero hay opciones mejores dependiendo del target:

| Resoluci√≥n | Aspect | Uso recomendado |
|------------|--------|-----------------|
| **1080x1920** | 9:16 | ‚úÖ **RECOMENDADO** - Portrait est√°ndar, m√°s com√∫n en m√≥viles |
| **1080x1350** | 4:5 | ‚úÖ V√°lido - Formato tipo Instagram, m√°s cuadrado |
| **720x1280** | 9:16 | ‚úÖ Budget m√≥viles, mismo aspect que 1080x1920 |
| **1080x2400** | 9:20 | ‚ö†Ô∏è Pantallas extra largas (Samsung S20+, etc.) |

### Recomendaci√≥n para este Proyecto

**Para jam/prototipo:**
- Mant√©n **1080x1350** si vas a publicar en web (formato tipo m√≥vil casual)
- Cambia a **1080x1920** si apuntas a App Store/Google Play

**Para producci√≥n:**
- Usa **1080x1920** (9:16) como base
- Dise√±a UI con **safe areas** para notches
- Testea en 720x1280 para dispositivos low-end

### C√≥mo Cambiar Resoluci√≥n

1. Abre `Project > Project Settings > Display > Window`
2. Cambia:
   - `Viewport Width`: 1080
   - `Viewport Height`: 1920 (o la que elijas)
3. Aseg√∫rate de que `Stretch Mode` = `2d`
4. Ajusta `Width` y `Height` (ventana desktop) proporcionalmente

### Consideraciones de Layout

Con **1080x1350**:
- ‚úÖ M√°s espacio vertical para UI de forja
- ‚ö†Ô∏è Menos espacio horizontal para el corredor
- ‚ö†Ô∏è DungeonLayout puede necesitar ajustes de zoom

Con **1080x1920**:
- ‚úÖ Formato m√≥vil est√°ndar
- ‚úÖ Mejor para corredor horizontal
- ‚ö†Ô∏è UI de forja puede sentirse "apretada" verticalmente

**Tip:** Usa `Control` nodes con `anchors` para que la UI se adapte a ambas resoluciones.

---

## üé® C√≥mo Personalizar Visualmente

### 1. Abrir DungeonLayout en el Editor

1. En Godot, navega a `res://scenes/DungeonLayout.tscn`
2. Haz doble clic para abrirla en el editor 2D

### 2. Estructura del √Årbol de Nodos

```
DungeonLayout (Node2D) ‚Äî Script: DungeonLayout.gd
‚îú‚îÄ ParallaxBackground (Node2D) ‚Äî Fondos en capas
‚îÇ   ‚îú‚îÄ BackLayer, BackLayer2, etc. (Sprite2D)
‚îú‚îÄ TileMap (Node2D) ‚Äî L√≠neas de suelo/techo placeholder
‚îÇ   ‚îú‚îÄ FloorLine (Line2D)
‚îÇ   ‚îî‚îÄ CeilingLine (Line2D)
‚îú‚îÄ Decorations (Node2D) ‚Äî Antorchas, props
‚îÇ   ‚îú‚îÄ Torch_01 a Torch_Boss (Label con emoji üî•)
‚îú‚îÄ HeroSpawn (Marker2D) ‚Äî Posici√≥n inicial del h√©roe
‚îî‚îÄ RoomZones (Node2D) ‚Äî Contenedor de salas
    ‚îú‚îÄ Room_01 (Area2D)
    ‚îÇ   ‚îú‚îÄ ZoneRect (ColorRect) ‚Äî Visualizaci√≥n de zona
    ‚îÇ   ‚îú‚îÄ RoomLabel (Label) ‚Äî "Sala 1"
    ‚îÇ   ‚îî‚îÄ EnemySpawn (Marker2D) ‚Äî Spawn del enemigo
    ‚îú‚îÄ Room_02 (Area2D)
    ‚îî‚îÄ ... hasta Room_09 (BOSS)
```

---

## üîß Tareas Comunes de Personalizaci√≥n

### A. A√±adir TileMap Real

**Actualmente:** L√≠neas placeholder  
**Mejora:** TileMap con texturas

1. Selecciona el nodo `TileMap`
2. B√≥rralo y crea un nuevo nodo `TileMap` (con TileSet)
3. Asigna tu TileSet con tiles de dungeon
4. Pinta el suelo y las paredes desde X=0 hasta X=6000 (cubre las 9 salas)

**Recomendaci√≥n de Layout:**
- **Suelo**: Y=490 a Y=540
- **Techo/Paredes**: Y=100 a Y=450
- **Ancho total**: ~6000px (600px por sala √ó 9 + margen)

### B. Reemplazar Antorchas por Sprites Animados

1. En `Decorations`, selecciona `Torch_01`
2. Borra el nodo Label
3. A√±ade `AnimatedSprite2D` con tu spritesheet de antorcha
4. Repite para las dem√°s antorchas

**Posiciones actuales:**
- Torch_01: X=400
- Torch_02: X=1000
- Torch_03: X=1600
- Torch_04: X=2200
- Torch_05: X=2800
- Torch_06: X=3400
- Torch_07: X=4000
- Torch_08: X=4600
- Torch_Boss: X=5200

### C. A√±adir Decoraci√≥n por Sala

Puedes a√±adir decoraci√≥n espec√≠fica dentro de cada `Room_XX`:

```
Room_03 (Area2D)
‚îú‚îÄ ZoneRect
‚îú‚îÄ RoomLabel
‚îú‚îÄ EnemySpawn
‚îî‚îÄ (NUEVO) Decoration
    ‚îú‚îÄ Pillar (Sprite2D)
    ‚îú‚îÄ Barrel (Sprite2D)
    ‚îî‚îÄ Chain (AnimatedSprite2D)
```

### D. Ajustar Posiciones de Spawn

**Para cambiar d√≥nde spawnea cada enemigo:**

1. Selecciona `RoomZones > Room_XX > EnemySpawn`
2. Mueve el Marker2D en el editor 2D
3. El c√≥digo usa `.global_position` autom√°ticamente

**Para el h√©roe:**

1. Selecciona `HeroSpawn` (ra√≠z de DungeonLayout)
2. Mu√©velo a la posici√≥n deseada

### E. Personalizar la Sala del Boss

La sala 9 ya tiene diferenciaci√≥n visual:
- `ZoneRect` con color rojo (Color(0.6, 0.2, 0.2, 0.15))
- `RoomLabel` con texto "SALA BOSS" en rojo
- Emoji de corona üëë

**Mejoras sugeridas:**
- A√±adir m√°s decoraci√≥n intimidante
- Cambiar el fondo (a√±adir sprites √∫nicos)
- A√±adir part√≠culas de fuego/humo

---

## üéØ Espaciado y Distribuci√≥n de Salas

### Posiciones Actuales (X)

| Sala | Posici√≥n X | Separaci√≥n |
|------|------------|------------|
| Hero Spawn | 100 | ‚Äî |
| Room_01 | 620 | 520px |
| Room_02 | 1220 | 600px |
| Room_03 | 1820 | 600px |
| Room_04 | 2420 | 600px |
| Room_05 | 3020 | 600px |
| Room_06 | 3620 | 600px |
| Room_07 | 4220 | 600px |
| Room_08 | 4820 | 600px |
| Room_09 (Boss) | 5420 | 600px |

**Total de recorrido:** ~5320px

### Cambiar Espaciado

Si quieres salas m√°s juntas o separadas:

1. Selecciona `Room_XX`
2. Cambia su `position.x` en el Inspector
3. Mant√©n coherencia (ej: todas a 500px de separaci√≥n)

**Recomendaci√≥n:** Mant√©n al menos 400-500px entre salas para que el h√©roe tenga tiempo de recorrer.

---

## üîç Sistema de Zonas (Area2D)

Cada `Room_XX` es un `Area2D` que **puede detectar triggers**:

```gdscript
# Ejemplo: Detectar cuando el h√©roe entra a una sala
func _ready():
	var room_05 = get_node("RoomZones/Room_05")
	room_05.body_entered.connect(_on_room_05_entered)

func _on_room_05_entered(body):
	if body.is_in_group("hero"):
		print("¬°H√©roe entr√≥ a la Sala 5!")
		# Aqu√≠ puedes: activar m√∫sica boss, spawnear efectos, etc.
```

**Futuras expansiones:**
- Puertas que se cierran al entrar
- Trampas activadas por zona
- Cambios de iluminaci√≥n

---

## üìê Parallax y Fondos

Actualmente hay 5 capas de fondo (`BackLayer` 1-5) que cubren el √°rea.

**Para a√±adir parallax real:**

1. Reemplaza el nodo `ParallaxBackground (Node2D)` por `ParallaxBackground` (nodo espec√≠fico de Godot)
2. A√±ade nodos `ParallaxLayer` hijos
3. Configura `motion_scale` para cada capa (ej: 0.3, 0.5, 0.7)

---

## üß™ Testing en el Editor

### Ver el Layout Completo

1. Abre `DungeonLayout.tscn`
2. En la toolbar superior, ajusta el **Zoom** al 10-25%
3. Ver√°s las 9 salas en l√≠nea horizontal

### Probar en Runtime

1. Ejecuta `Main.tscn` (F5)
2. Haz clic derecho del rat√≥n para cambiar a Dungeon
3. Observa que:
   - El h√©roe spawnea en la posici√≥n del marker `HeroSpawn`
   - Los enemigos spawnean en las posiciones de cada `Room_XX/EnemySpawn`
   - La c√°mara sigue al h√©roe a trav√©s del layout

### Verificar Posiciones en Consola

Busca en el output de Godot:
```
DungeonLayout: Ready with 9 room zones
Corridor: DungeonLayout found at ...
Corridor: Using DungeonLayout hero spawn: (100, 460)
Corridor: Using DungeonLayout spawn position for level 1: (620, 460)
```

---

## üé® Pr√≥ximos Pasos Creativos

### Fase 1: Reemplazar Placeholders
- [ ] Crear/importar TileSet de dungeon
- [ ] Pintar suelo, paredes, techo con tiles
- [ ] Reemplazar emojis de antorcha con sprites animados
- [ ] A√±adir sprites de fondo (columnas, arcos)

### Fase 2: Decoraci√≥n por Sala
- [ ] Sala 1-3: Dungeon b√°sico (antorchas, barriles)
- [ ] Sala 4-6: Dungeon intermedio (cadenas, huesos)
- [ ] Sala 7-8: Dungeon avanzado (sangre, runas)
- [ ] Sala 9: Arena del boss (altar, fuego, s√≠mbolos)

### Fase 3: FX y Ambiente
- [ ] Part√≠culas de polvo en todas las salas
- [ ] Luces din√°micas (PointLight2D en antorchas)
- [ ] A√±adir neblina (CanvasModulate o shaders)
- [ ] Sistema de parallax multi-capa

### Fase 4: Mec√°nicas Avanzadas
- [ ] Puertas que se abren al derrotar enemigo
- [ ] Trampas activadas por `Area2D`
- [ ] Eventos especiales (spawn de cofre, buff temporal)
- [ ] Transiciones visuales entre salas

---

## üêõ Troubleshooting

### El h√©roe/enemigo no spawnea en las posiciones correctas

**Causa:** DungeonLayout no se encuentra en el √°rbol  
**Soluci√≥n:** Verifica en consola que aparezca:
```
Corridor: DungeonLayout found at ...
```

Si no aparece:
1. Aseg√∫rate de que `DungeonLayout` es hijo de `DungeonArea` en `Main.tscn`
2. Verifica que `DungeonLayout.tscn` tenga el script asignado

### Las decoraciones no se ven

**Causa:** Z-index incorrecto o posici√≥n fuera de c√°mara  
**Soluci√≥n:**
1. Revisa que `DungeonLayout` tenga `z_index = -5`
2. Verifica que `Decorations` no tenga `z_index` negativo excesivo
3. Comprueba que la c√°mara est√© centrada en el √°rea dungeon (Y=3360)

### Los enemigos spawnean todos en el mismo lugar

**Causa:** Los markers `EnemySpawn` no tienen posiciones √∫nicas  
**Soluci√≥n:**
1. Abre `DungeonLayout.tscn`
2. Selecciona cada `Room_XX` y verifica que su `position.x` sea diferente
3. Los `EnemySpawn` heredan la posici√≥n del padre `Room_XX`

---

## üìö Referencia T√©cnica

### API de DungeonLayout.gd

```gdscript
class_name DungeonLayout

# Obtiene posici√≥n de spawn para enemigo de nivel especificado
func get_enemy_spawn_for_level(level: int) -> Vector2

# Obtiene posici√≥n inicial del h√©roe
func get_hero_spawn() -> Vector2

# Verifica si el nivel es el boss
func is_boss_level(level: int) -> bool

# Obtiene la zona de sala para el nivel (para triggers)
func get_room_zone(level: int) -> Area2D
```

### Constantes en DungeonLayout.gd

```gdscript
const FALLBACK_SPAWN := Vector2(620, 460)  # Spawn por defecto si falla
const ROOM_SPACING := 600.0  # Separaci√≥n est√°ndar entre salas
```

---

## üí° Consejos Finales

1. **Itera en peque√±os pasos:** Primero reemplaza placeholders, luego a√±ade decoraci√≥n
2. **Usa grupos de nodos:** Agrupa decoraciones similares para editarlas en batch
3. **Guarda versiones:** Crea copias de `DungeonLayout.tscn` antes de cambios grandes
4. **Prueba frecuentemente:** Ejecuta el juego cada vez que a√±adas decoraci√≥n para ver el resultado
5. **Mant√©n el performance:** No a√±adas cientos de nodos; usa TileMap para repetici√≥n

---

üéâ **¬°El layout de dungeon ahora es completamente visual y manipulable!** üéâ
